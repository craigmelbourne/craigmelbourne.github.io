<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Meta tags -->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="mobile-web-app-capable" content="yes">

		<!-- style sheets -->
		<link rel="stylesheet" type="text/css" href="reset.css">
		<link rel="stylesheet" type="text/css" href="base.css">

		<style type="text/css">
		body{margin:0; color:#555;}
		a {text-decoration:none;}
		</style>

		<!-- Scripts -->
		<!-- JQuery Google CDN -->
		

		

	</head>

	<body>

		<div id="header-wrapper"></div>
		<style type="text/css">

			#page-wrapper {max-width:360px; margin:0px auto;}
			#search-details {background-color: #e5e3db; padding:10px;}
			#search-details .destination {font-size:14px; font-weight: bold; margin-bottom:4px;}
			#search-details .dates {font-size:12px;  }
       		#search-details a {background-color:#000; color:#fff; display:inline-block; padding:8px; margin-top:8px; border-radius:4px; font-size:12px;}
       		#tools select {font-size: 18px; width:calc(100% - 134px);}

       		#tools {padding:10px; border-bottom: solid 1px #eee;}
       		#tools #filters, #tools #map  {display:inline-block; background-color:#026dc5; color:#fff; width:60px; padding:8px 0; text-align: center; border-radius: 4px; font-size: 13px}
			
			.hotel{padding:12px; border-bottom:solid 1px #eee;}
			
			.hotel .thumbnail {height:70px; width:70px; overflow:hidden; border-radius:4px; display:inline-block; vertical-align: top;}
			.hotel .thumbnail img {  background-size: cover; height: 70px; width: 107px;}

			.hotel .hotels-details {display:inline-block; vertical-align: top; width:calc(100% - 82px); box-sizing:border-box; padding-left:8px;}
			.hotel .hotels-details .name {font-size:14px; display:block; margin-bottom:4px;}
			.hotel .hotels-details .neighbourhood {font-size:12px;}
			.hotel .hotels-details .guest {font-size:12px; font-weight:bold; margin-top:4px;}

			.hotel .price {margin-top:10px;}
			.hotel .price .special-deal {color:#d41200; font-size:12px; margin-bottom: 4px; margin-left:-12px; }
			.hotel .price .special-deal .badge {display:inline-block; background-color:#d41200; color:#fff; padding:4px 8px 4px 12px; vertical-align: top; font-weight: bold; border-top-right-radius: 4px; border-bottom-right-radius: 4px;}
			.hotel .price .special-deal .label {display:inline-block; padding:4px; vertical-align: top; font-weight: bold}
			.hotel .price .great-deal {color:#d41200; margin-bottom:4px; font-size:12px;}
			.hotel .price .total-price {font-size: 20px; font-weight: bold}
			.hotel .price .red {color:#d41200;}
			.hotel .price .strikethrough {text-decoration: line-through; font-size:14px;}
			.hotel .price .avgPriceDescription {font-size:11px; color:#999;}

			#modal-not-available {position:fixed; top:0; left:0; right:0; bottom:0; background-color:#fff; opacity:0.9; text-align: center; padding:100px 20px 20px; display:none;}

			#modal-not-available #message {font-size:20px; font-weight:bold; margin-bottom:40px;}
			
       	</style>
       	
		<div id="page-wrapper" style="">
            <div id="search-details">
            	<div class="destination"></div>
                <div class="dates">01/08/2015 - 02/08/2015 1 room, 1 adult, 1 child</div>
                <a class="change-search">Change search</a>
            </div>

            <div id="tools">
            	<a id="filters" href="#">Filters</a>
            	<a id="map" href="#">Map</a>
            	<select disabled>
            		<option>Sort by Our favourites</option>
            		<option>Price</option>
            	</select>
            </div>

			<div id="hotelList">
			</div>

			<script id="hotelListTemplate" type="text/x-handlebars">
    			
      				{{#each hotels}}
      					<div class="hotel">
      						<div class="thumbnail">
      							<img src="{{imageUrl}}" />
      						</div>
      						<div class="hotels-details">
        			 			<a href="#{{hotelId}}" class="name">{{hotelName}}</a>
        			 			<img src="i/stars_srp_{{hotelStars}}.png" /> 
        			 			<span class="neighbourhood">{{neighbourhood}}</span>
        			 			<div class="guest">{{qualitativeBadgeText}} {{guestReviewRating}} / 5</div>
        			 		</div>
        			 		<div>
        			 			{{hotelPrice}}
        			 		</div>
        			 	</div>
      				{{/each}}
   				 
  			</script>
		</div>

		<div id="modal-not-available">
			<div id="message"></div>
			<a href="#">Close</a>
		</div>


		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="hcom-services.js"></script>
		<script src="js/handlebars-v3.0.3.js"></script>

		<script type="text/javascript">
		
		var hotelListData;

		//var destination = "London";

		var displayList = function(data){
			
			var hotels = data.result.hotels;

			$.each(hotels, function(i, hotel) {
				
				$("#hotelList").append(
					'<div style="padding:8px 0"><a href="pdp-roomrates.html?hotelId='+hotel.hotelId + '">' + hotel.hotelName + '</a></div>'
				)
				
			});
			
		}

			// run things on page load
			$(function(){
      			$("#header-wrapper").load("components/header.html");
      			var destination = "London, United Kingdom"

      			if (getParameterByName("destination")){
      				destination = getParameterByName("destination");
      			} 

      			$("#search-details .destination").text(destination)

      			
      			//fetchHotelList(destination, displayList);

      			$.getJSON( "srp.json", function( data ) { 
					hotelListData = data.result;
					console.log(hotelListData.hotels)
					buildListTemplate(hotelListData);
				});

      			var buildListTemplate = function(data) {
      				var source = $("#hotelListTemplate").html();
					var template = Handlebars.compile(source);
					$("#hotelList").html(template(data));
      			}

      			Handlebars.registerHelper('neighbourhood', function() {
  						var neighbourhood = this.location.split("/")
  						return neighbourhood[0]
  				});

  				Handlebars.registerHelper('hotelStars', function() {
  						var stars = Math.floor(this.starRating);
  						return stars;
  				});

  				

  				Handlebars.registerHelper('hotelPrice', function() {
  						
  						var result = '<div class="price">';

  						if (this.promoPrice) {
  							if (this.promoPriceDescription != ""){
  								result += '<div class="special-deal"><div class="badge">Special deal</div> <div class="label">' + this.promoPriceDescription + '</div></div>'
  							} else {
  								result += '<div class="great-deal">Great deal</div>'
  							}
  							result += '<span class="strikethrough">' + this.avgPrice + '</span> <span class="total-price red">' + this.promoPrice + '</span>' ;
  						} else {
  							result += '<span class="total-price">' + this.avgPrice + '</span> ';
  						}

  						result += ' <span class="avgPriceDescription">' + this.avgPriceDescription + ' including taxes & fees</span></div>'

  						return new Handlebars.SafeString(result);
  				});


				// modal functiona not available states
				$("#tools #filters").on("click", function(){
      				$("#modal-not-available").show().find("#message").text("Filters are not available on this prototype")
      			}); 

      			$("#tools #map").on("click", function(){
      				$("#modal-not-available").show().find("#message").text("Map tool is not available on this prototype")
      			});

      			$("#tools select").on("click", function(e){
      				e.preventDefault();
      				$("#modal-not-available").show().find("#message").text("Sort tool is not available on this prototype")
      			});

      			$("#modal-not-available a").on("click", function(){
      				$("#modal-not-available").hide();
      			})

				
      			
			});

		</script>
		
	</body>
</html>