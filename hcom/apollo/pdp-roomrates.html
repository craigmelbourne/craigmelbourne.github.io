<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Meta tags -->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="mobile-web-app-capable" content="yes">

		<!-- style sheets -->
		<link rel="stylesheet" type="text/css" href="reset.css">
		<link rel="stylesheet" type="text/css" href="base.css">

		<style type="text/css">
			body {background-color: #f5f4f0; margin:0; padding:0; color:#555;}
			a {text-decoration: none; color:#026dc5;}
			.room {background-color:#fff; border-radius:4px; margin-bottom:8px;}
			.room .room-detail .thumbnail {border:solid 4px #fff; border-top-left-radius:4px; border-top-right-radius:4px;}
			.room .room-detail .thumbnail img {width:100%; border-top-left-radius:4px; border-top-right-radius:4px;}

			ul.room-highlights {margin-top:16px;}
			ul.room-highlights li {color:#458f00; font-size:13px; margin-bottom:8px;}

			.room-description {font-size:13px; margin-top:8px; line-height: 16px; display:none;}
			.room-amenities {margin-top:8px;}
			.room-amenities li {margin-bottom:4px; font-size:13px;}
			ul.highlights {margin-top:8px;}
			ul.highlights li {font-size:13px; margin-bottom:4px;}
			.price {font-size:18px; color:#d41200; text-align: right}

			.cancellation {font-size:13px; margin-bottom:8px;}
			.free {color:#458f00;}
			.rewards ul li {font-size:13px; color:#906; margin-top:4px;}

.rate {margin:8px 16px; border-top:solid 1px #eee; padding-top:8px;}
#rooms-rates {display:none;}
#show-room-rates {background-color:#2989d7; color:#fff; padding:8px 16px; margin-top:16px; text-align: right;}
#show-room-rates:hover {cursor: pointer;}

 button {  background: linear-gradient(to bottom,#95cffe 0%,#30a0fd 40%,#2989d7 100%);
  -ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorStr='#FF95CFFE',EndColorStr='#FF2989D7')";
  zoom: 1;
  background-position: 50%;
  border: 1px solid #bbe9ff;
  border-bottom-color: #30a0fd;
  border-left-color: #95cffe;
  border-right-color: #95cffe;
  border-radius: 3px;
  box-shadow: 0 0 0 1px #30a0fd,1px 1px 0.5px 1px rgba(60,163,227,0.3);
  color: #fff;
  cursor: pointer;
  display: inline-block;
  font-size: 14px;
  font-weight: bold;
  line-height: 1.5;
  margin: 0 2px 4px;
  overflow: hidden;
  padding: 2px 10px;
  position: relative;
  vertical-align: middle;
  width: auto;}

		</style>

		<!-- Scripts -->
		<script src="hcom-services.js"></script>
		<!-- JQuery Google CDN -->
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

		<script type="text/javascript">

		 
		var roomTypeId = [];
		var numRooms;
		var roomTypeOrder = [];

		var displayDetails = function(data){

			
			var rooms = data.result.roomRates.roomDetails
			var hotelSummary = data.result.roomRates.hotelSummary;
			var photos = data.result.photos;
			var staticMapUrl =  data.result.map.staticMapUrl


			console.log(data.result)
			console.log(photos[0].url)

			// hotel-details
			$("h1").text(hotelSummary.hotelName);
			$("#address").text(hotelSummary.address1 + ", " + hotelSummary.postalCode + ", " + hotelSummary.locality); 

			$("#hotel-description").prepend("<div>" + data.result.description.overview + "</div>")

			

			

			if (data.result.roomRates.promoLowPrice) {
				$("#price").text(data.result.roomRates.promoLowPrice)
			}

			$("#priceInfo").text(data.result.roomRates.priceInfo)
			$("#priceSummary").text(data.result.roomRates.priceSummary)

			$("#photos").append('<img src="' + photos[0].url + '" />');

			$("#map").append('<img src="' + staticMapUrl + '" />');

			$("#guest-reviews").prepend(
				'<div class="score">' + hotelSummary.qualitativeBadgeText + " " + Math.round(hotelSummary.guestRatingValue * 10) / 10 + '<span style="font-size:14px"> / 5</span></div>'
				+ '<div class="review-count"><a href="#">See all ' + hotelSummary.reviewsTotalCount + ' Hotels.com reviews</a></div>'
			);

			// rooms	

			$.each(rooms, function(i, room) {
				if (roomTypeId.indexOf(room.roomTypeCode) == -1){
					roomTypeId.push(room.roomTypeCode);
				};
			}); 

			
			numRooms = roomTypeId.length
			

			for( var i=0; i<numRooms; i++ ) {
  				roomTypeOrder.push( [] );
			}

			$.each(rooms, function(i, room) {
				
				roomTypeOrder[roomTypeId.indexOf(room.roomTypeCode)].push(room);
				
			});

			console.log(roomTypeOrder);

			$.each(roomTypeOrder, function(i, obj ) {
    			//console.log(obj)
    			var roomHTML = "";
    			
    			// thumbnail
    			var newIMGURLHTML = ""
    			if (obj[0].hotelDetailsPhoto) {
    				var imgURL = obj[0].hotelDetailsPhoto;
    				var newIMGURL = imgURL.replace("_t.jpg", "_l.jpg");
    				var newIMGURLHTML = '<div class="thumbnail"><img src="' + newIMGURL + '" /></div>'
    			}
    			

    			// occupancy 
    			var occupancyHTML = "";

    			if (obj[0].occupancy.maxAdults <= 3){
    				for (var i=0; i<obj[0].occupancy.maxAdults; i++){
    					occupancyHTML += '<img src="i/adult_icon.png"/>'
    				}
    			} else {
    				occupancyHTML = obj[0].occupancy.maxAdults + ' x <img src="i/adult_icon.png"/>';
    			}

    			// room highlights
    			var roomHighlights = '<ul class="room-highlights"><li>Free WiFi on some room rates</li></ul>'

    			//room description
    			var roomDescription;
    			var roomAmenities =  data.result.amenities.roomAmenities.values; 
    			var roomAmenity;

    			//console.log(roomAmenities.length)

    			var roomAmenitiesHTML = '<ul class="room-amenities">'; 

    			for (var i=0; i<roomAmenities.length; i++){
    					roomAmenitiesHTML += "<li>" + roomAmenities[i] + "</li>";
    			}

    			roomAmenitiesHTML += "</ul>";

    			roomDescription = '<div class="room-description">' + obj[0].roomTypeQualifier;
    			roomDescription += roomAmenitiesHTML;
    			roomDescription += '</div>';
    			// room rates

    			// price
    			var fromPrice = "not set"; 

    			if (!obj[0].roomPrice.priceModule.priceNormal){
    				fromPrice = obj[0].roomPrice.priceModule.priceOrig;
    			} else {
    				fromPrice = obj[0].roomPrice.priceModule.priceNormal;
    			}

    			

    			var showRoomRatesHTML = '<div id="show-room-rates">' + obj.length + ' options from ' + fromPrice + '</div>'

    			// room rates
    			$.each(obj, function( key, rate ) {
    				//console.log(rate.highlights); 

    				var wrHTML = '<div class="rewards"><img src="i/wr_logo.png" /><ul>'

    				if (rate.welcomeRewardsFlags.welcomeRewardsCollect){
    					wrHTML += "<li>Collect</li>"
    				}

    				if (rate.welcomeRewardsFlags.welcomeRewardsRedeem){
    					wrHTML += "<li>Redeem</li>"
    				}

    				wrHTML += '</ul></div>'
    				var rateHighlights = "<div><ul class='highlights'>";

    				var cancellation = "";
    				var pay_at_hotel = ""

    				for (var i=0; i<rate.highlights.length; i++){

    					


    					switch(rate.highlights[i].id) {
    						case "2048":
    							
    							if (rate.highlights[i].enabled){
    								rateHighlights +=  "<li>" + rate.highlights[i].description + "</li>" ;
    							}
    							break;
    						case "FREE_CANCELLATION":
    							
    							if (rate.highlights[i].enabled){
    					

    								cancellation = '<div class="cancellation free">' 
    												+ rate.highlights[i].description

    								if(rate.freeCancellationPeriodEndText) {
    									cancellation += "<div>" + rate.freeCancellationPeriodEndText + "</div>"
    								}

    								cancellation += "</div>"

    							}
    							break;
    						case "RATE_NON_REFUNDABLE":
    							if (rate.highlights[i].enabled){
    								
    								cancellation = '<div class="cancellation">' + rate.highlights[i].description + '</div>'
    							}
    							
    							break;
    						case "BREAKFAST_INCLUDED":
    							if (rate.highlights[i].enabled){
    								rateHighlights +=  "<li>" + rate.highlights[i].description + "</li>" ;
    							}
    							break;
    						case "PAY_AT_HOTEL":
    							
    							if (rate.highlights[i].enabled){
    								pay_at_hotel = '<div style="font-size:12px; margin-top:8px; color:#458f00;">' + rate.highlights[i].description + '</div>';
    							}
    							break;
    						case "LOWEST_PRICE_GUARANTEED":
    							
    							break;

    					}

    					
    				}

    				rateHighlights += "</ul></div>"


    				var ratePrice = "";

    				if (!rate.roomPrice.priceModule.priceNormal){
    					ratePrice = rate.roomPrice.priceModule.priceOrig;
    				} else {
    					ratePrice = rate.roomPrice.priceModule.priceNormal;
    				}

    				//console.log(rateHighlights);

    				roomHTML += '<div class="rate">' 
    							+ cancellation 
    							+ wrHTML
    							+ rateHighlights
    							+ '<div class="price">' + ratePrice + '</div>'
    							+ '<div class="book" style="text-align:right; margin:8px 0; border-top:dotted 1px #ccc; padding-top:8px;"><div style="font-size:12px; color:#999; padding-bottom:8px;">Price for 1 night including all taxes and fees</div><button style="background-color:#2989d7; color:#fff; border-radius:4px; border:0; font-size:14px; padding:4px 16px;">Book now</button>' + pay_at_hotel + '</div>'
    							+ '</div>'
        			
    			});

    			$("#rooms-wrapper").append(
    				'<div class="room">' 
    				+ '<div class="room-detail">'
    					+ newIMGURLHTML
    					+ '<div style="padding:4px 16px 16px;">' 
    						+ '<div style="font-size:16px; font-weight:bold;">' + obj[0].roomRateName + '</div>'
    						+ '<div style="margin:8px  0 0; font-size:12px">' 
    							+ '<div style="display:inline-block; vertical-align:top; margin-right:16px;"><img src="i/room_size.png" /></div>'
    							+ '<div style="display:inline-block; vertical-align:top; padding-top:6px">' + occupancyHTML + '</div>'
    						+ roomHighlights
    						+ '<div style="font-size:13px; padding:8px 0;">' + obj[0].bedTypes[0] + '</div>'
    						
    						+ '<div><a href="#" class="showmore" style="font-size:13px">Room information</a>'
    						+ roomDescription

    					+ '</div>'

    				+ '</div>' 
    				
    				//+ '<div class="rates">' + roomHTML + '</div>'
    				+ '</div>'
    				+ '<div id="rooms-rates">'
    				+ roomHTML
    				+ '</div>'
    				+ showRoomRatesHTML
    				
    			);
			});


		}

			// run things on page load
			$(function(){

				var hotelId = getParameterByName("hotelId") //"215012"
				//fetchHotelDetails(hotelId, displayDetails);

				$.getJSON( "pdp.json", function( data ) {
					console.log(data)
					displayDetails(data)
				});

				$("#rooms-wrapper").on("click", ".showmore", function(e){
					e.preventDefault();
					$(this).siblings(".room-description").show();
				}); 
				$("#rooms-wrapper").on("click", "#show-room-rates", function(e){
					e.preventDefault();
					$(this).siblings("#rooms-rates").toggle();
					//alert("clicked")
				});

				$("#hotel-description a").on("click", function(e){
					e.preventDefault();
					$("#hotel-description > div").toggleClass("open");
				})


				$("#header-wrapper").load("http://craigmelbourne.github.io/hcom/apollo/components/header.html");
			});

		</script>

	</head>

	<body>

	<style type="text/css">
		
        #search-details {font-size:12px; padding:8px; background-color: #e5e3db;}
        #search-details a {background-color:#000; color:#fff; display:inline-block; padding:8px; margin-top:8px; border-radius:4px;}
        #hotel-details  {padding:16px 8px 8px 48px; background:url("i/wr_moon.png") no-repeat; background-size:30px; background-position:8px 14px;}
		#hotel-details h1 {font-size:16px; font-weight:bold; margin-bottom:4px;}

		#hotel-details #address {font-size:12px;}
		#hotel-details #phonenumber {color:blue; font-size:12px; margin-top:4px}

		#photos {overflow:hidden;}
		#photos img {width: 100%}
		#map {overflow:hidden; height:150px;}
		#map img {}

		#price {font-size:24px; font-weight:bold; padding:0 8px; color:#d41200;}
		#priceInfo {padding:0 8px; font-size:14px; margin-top:4px;}
		#priceSummary {padding:0 8px; font-size:14px; margin-top:4px;}
		
	</style>
        <div id="header-wrapper"></div>
		<div id="page-wrapper" style="max-width:360px; margin:0px auto; padding:0">
            <div id="search-details">
                <div class="dates">01/08/2015 - 02/08/2015 1 room, 1 adult, 1 child</div>
                <a class="change-search">Change search</a>
            </div>
			
			<div id="hotel-details">
				<h1></h1>
				<div id="address"></div>
				<div id="phonenumber">0203 564 4408‎</div>
			</div>
			
			<div id="price"></div>
			<div id="priceInfo"></div>
			<div id="priceSummary"></div>

            <style type="text/css">
               
            </style>

			<div style="overflow:hidden; margin:16px 8px;">
				<div style="width:50%; float:left; font-size:14px; color:#003789; font-weight:bold; padding-top:4px">Best price guarantee</div>
				<div style="float:right; text-align:right;"><button>Book now</button></div>
			</div>
			

             <style type="text/css">
                #photos {background-color:#000; height:200px;}
                
            </style>
			<div id="photos">
				
			</div>

            <style type="text/css">
                #hotel-description {padding:8px; margin:8px;  border-bottom:solid 1px #ccc; }

                #hotel-description > div {font-size:13px; line-height: 16px; height:120px; overflow:hidden;}
                #hotel-description > div.open {height:auto;}
                #hotel-description > div p {margin-bottom:8px;}
                #hotel-description > div b {font-weight: bold;}
                #hotel-description a {display:block; padding:8px 0 0px; text-align: center; font-size:13px;}
            </style>
			<div id="hotel-description">
				<a href="#">See more</a>
			</div>

            <style type="text/css">
                #map {margin:8px; border-radius: 4px; border:solid 1px #ccc;}
            </style>
			<div id="map">
				
			</div>

            <style type="text/css">
                #guest-reviews {padding:16px; margin:8px; background-color:#fff; border-radius: 4px; border:solid 1px #ccc;}
                .score {font-size:22px; font-weight: bold; margin-bottom:8px;}
                .review-count {font-size: 13px}
            </style>
			<div id="guest-reviews">
				<div style="margin-top:16px;">
					<img src="i/tripadvisor_score.png" style="height:30px"/>
					<div style="display:inline-block; vertical-align: top;"><div style="font-size:12px; padding-top:2px; margin-bottom:4px">From 1,068 reviews</div><div style="font-size:11px; color:#999">TripAdvisor Traveller Rating</div></div>
				</div>
			</div>

            <style type="text/css">
                ul.tools li {display:inline-block;  margin-right:8px; color:#026dc5; font-size:14px; font-weight:bold;}
            </style>
            <div style="padding:8px;">
                <ul class="tools">
                    <li>Price Watch</li>
                    <li>&#8226; &nbsp; Email</li>
                    <li>&#8226; &nbsp; Share</li>
                    <li>&#8226; &nbsp; Save</li>
                </ul>
            </div>

            <style type="text/css">
                #rewards {border-top:solid 1px #ccc; border-bottom:solid 1px #ccc; padding:8px; font-size:14px; margin-top:8px;}
                #rewards > div.brand {margin-bottom:8px; color:#906; font-weight:bold;}
                #rewards > div.nights {margin-bottom:8px; color:#906; }
                #rewards > div.remember { font-size:13px;}
            </style>
			<div id="rewards">
				<div class="brand">Hotels.com&#8482; Rewards</div>
                <div class="nights">You'll collect 1 night with this stay</div>
                <div class="remember">Remember collect 10 nights, get 1 free</div>
			</div>
			
            <style type="text/css">
                #search-details-2 {font-size:12px; padding:8px; background-color: #fff; margin-top:16px;}
                #search-details-2 a {  display:inline-block;  margin-top:8px; }
            </style>
            <div id="search-details-2">
                <div class="dates">01/08/2015 - 02/08/2015 1 room, 1 adult, 1 child</div>
                <a class="change-search">Change search</a>
            </div>

            <style type="text/css">
                .book-now {background-color: #DAE9CC; padding:16px 8px; margin:16px 0; font-size:14px; background: url('i/icon_lock.png') no-repeat #DAE9CC; background-size: 35px; background-position: 10px}
                .book-now > div {font-weight:bold; margin-left:50px;}
                .book-now > p {margin-top:8px; margin-left:50px;}
            </style>

            <div class="book-now">
                <div >Book now to get this fantastic price.</div>
                <p>If you book later, there’s a chance the price will go up or the hotel will be sold out.</p>
            </div>

			<div id="rooms-wrapper" >
			</div>

		</div>

		

		
	</body>
</html>