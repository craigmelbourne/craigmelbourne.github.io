<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Meta tags -->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="mobile-web-app-capable" content="yes">

		<!-- style sheets -->
		<link rel="stylesheet" type="text/css" href="reset.css">
		<link rel="stylesheet" type="text/css" href="base.css">

		<style type="text/css">
			body {background-color: #e5e3db; margin:0; padding:0;}
			a {text-decoration: none;}
			.room {background-color:#fff; border-radius:4px; margin-bottom:8px;}
			.room .room-detail .thumbnail {border:solid 4px #fff; border-top-left-radius:4px; border-top-right-radius:4px;}
			.room .room-detail .thumbnail img {width:100%; border-top-left-radius:4px; border-top-right-radius:4px;}

			ul.room-highlights {margin-top:16px;}
			ul.room-highlights li {color:#458f00; font-size:13px; margin-bottom:8px;}

			.room-description {font-size:13px; margin-top:8px; line-height: 16px; display:none;}
			.room-amenities {margin-top:8px;}
			.room-amenities li {margin-bottom:4px; font-size:13px;}
			ul.highlights {margin-top:8px;}
			ul.highlights li {font-size:13px; margin-bottom:4px;}
			.price {font-size:18px; color:#d41200; text-align: right}

			.cancellation {font-size:13px; margin-bottom:8px;}
			.free {color:#458f00;}
			.rewards ul li {font-size:13px; color:#906; margin-top:4px;}

.rate {margin:8px 16px; border-top:solid 1px #eee; padding-top:8px;}
#rooms-rates {display:none;}
#show-room-rates {background-color:#2989d7; color:#fff; padding:8px 16px; margin-top:16px; text-align: right;}
#show-room-rates:hover {cursor: pointer;}

		</style>

		<!-- Scripts -->
		<script src="hcom-services.js"></script>
		<!-- JQuery Google CDN -->
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

		<script type="text/javascript">

		 
		var roomTypeId = [];
		var numRooms;
		var roomTypeOrder = [];

		var displayDetails = function(data){

			
			var rooms = data.result.roomRates.roomDetails
			var hotelSummary = data.result.roomRates.hotelSummary;
			var photos = data.result.photos;
			var staticMapUrl =  data.result.map.staticMapUrl


			console.log(data.result)
			console.log(photos[0].url)

			// hotel-details
			$("h1").text(hotelSummary.hotelName);
			$("#address").text(hotelSummary.address1 + ", " + hotelSummary.postalCode + ", " + hotelSummary.locality); 

			$("#guest-reviews").append(
				'<div class="score">' + hotelSummary.qualitativeBadgeText + " " + Math.round(hotelSummary.guestRatingValue * 10) / 10 + '</div>'
				+ '<div><a href="#">See all ' + hotelSummary.reviewsTotalCount + ' Hotels.com reviews</a></div>'
			);

			

			if (data.result.roomRates.promoLowPrice) {
				$("#price").text(data.result.roomRates.promoLowPrice)
			}

			$("#priceInfo").text(data.result.roomRates.priceInfo)
			$("#priceSummary").text(data.result.roomRates.priceSummary)

			$("#photos").append('<img src="' + photos[0].url + '" />');

			$("#map").append('<img src="' + staticMapUrl + '" />');

			// rooms	

			$.each(rooms, function(i, room) {
				if (roomTypeId.indexOf(room.roomTypeCode) == -1){
					roomTypeId.push(room.roomTypeCode);
				};
			}); 

			
			numRooms = roomTypeId.length
			

			for( var i=0; i<numRooms; i++ ) {
  				roomTypeOrder.push( [] );
			}

			$.each(rooms, function(i, room) {
				
				roomTypeOrder[roomTypeId.indexOf(room.roomTypeCode)].push(room);
				
			});

			console.log(roomTypeOrder);

			$.each(roomTypeOrder, function(i, obj ) {
    			//console.log(obj)
    			var roomHTML = "";
    			
    			// thumbnail
    			var newIMGURLHTML = ""
    			if (obj[0].hotelDetailsPhoto) {
    				var imgURL = obj[0].hotelDetailsPhoto;
    				var newIMGURL = imgURL.replace("_t.jpg", "_l.jpg");
    				var newIMGURLHTML = '<div class="thumbnail"><img src="' + newIMGURL + '" /></div>'
    			}
    			

    			// occupancy 
    			var occupancyHTML = "";

    			if (obj[0].occupancy.maxAdults <= 3){
    				for (var i=0; i<obj[0].occupancy.maxAdults; i++){
    					occupancyHTML += '<img src="i/adult_icon.png"/>'
    				}
    			} else {
    				occupancyHTML = obj[0].occupancy.maxAdults + ' x <img src="i/adult_icon.png"/>';
    			}

    			// room highlights
    			var roomHighlights = '<ul class="room-highlights"><li>Free WiFi on some room rates</li></ul>'

    			//room description
    			var roomDescription;
    			var roomAmenities =  data.result.amenities.roomAmenities.values; 
    			var roomAmenity;

    			//console.log(roomAmenities.length)

    			var roomAmenitiesHTML = '<ul class="room-amenities">'; 

    			for (var i=0; i<roomAmenities.length; i++){
    					roomAmenitiesHTML += "<li>" + roomAmenities[i] + "</li>";
    			}

    			roomAmenitiesHTML += "</ul>";

    			roomDescription = '<div class="room-description">' + obj[0].roomTypeQualifier;
    			roomDescription += roomAmenitiesHTML;
    			roomDescription += '</div>';
    			// room rates

    			// price
    			var fromPrice = "not set"; 

    			if (!obj[0].roomPrice.priceModule.priceNormal){
    				fromPrice = obj[0].roomPrice.priceModule.priceOrig;
    			} else {
    				fromPrice = obj[0].roomPrice.priceModule.priceNormal;
    			}

    			

    			var showRoomRatesHTML = '<div id="show-room-rates">' + obj.length + ' options from ' + fromPrice + '</div>'

    			// room rates
    			$.each(obj, function( key, rate ) {
    				//console.log(rate.highlights); 

    				var wrHTML = '<div class="rewards"><img src="i/wr_logo.png" /><ul>'

    				if (rate.welcomeRewardsFlags.welcomeRewardsCollect){
    					wrHTML += "<li>Collect</li>"
    				}

    				if (rate.welcomeRewardsFlags.welcomeRewardsRedeem){
    					wrHTML += "<li>Redeem</li>"
    				}

    				wrHTML += '</ul></div>'
    				var rateHighlights = "<div><ul class='highlights'>";

    				var cancellation = "";
    				var pay_at_hotel = ""

    				for (var i=0; i<rate.highlights.length; i++){

    					


    					switch(rate.highlights[i].id) {
    						case "2048":
    							
    							if (rate.highlights[i].enabled){
    								rateHighlights +=  "<li>" + rate.highlights[i].description + "</li>" ;
    							}
    							break;
    						case "FREE_CANCELLATION":
    							
    							if (rate.highlights[i].enabled){
    					

    								cancellation = '<div class="cancellation free">' 
    												+ rate.highlights[i].description

    								if(rate.freeCancellationPeriodEndText) {
    									cancellation += "<div>" + rate.freeCancellationPeriodEndText + "</div>"
    								}

    								cancellation += "</div>"

    							}
    							break;
    						case "RATE_NON_REFUNDABLE":
    							if (rate.highlights[i].enabled){
    								
    								cancellation = '<div class="cancellation">' + rate.highlights[i].description + '</div>'
    							}
    							
    							break;
    						case "BREAKFAST_INCLUDED":
    							if (rate.highlights[i].enabled){
    								rateHighlights +=  "<li>" + rate.highlights[i].description + "</li>" ;
    							}
    							break;
    						case "PAY_AT_HOTEL":
    							
    							if (rate.highlights[i].enabled){
    								pay_at_hotel = '<div style="font-size:12px; margin-top:8px; color:#458f00;">' + rate.highlights[i].description + '</div>';
    							}
    							break;
    						case "LOWEST_PRICE_GUARANTEED":
    							
    							break;

    					}

    					
    				}

    				rateHighlights += "</ul></div>"


    				var ratePrice = "";

    				if (!rate.roomPrice.priceModule.priceNormal){
    					ratePrice = rate.roomPrice.priceModule.priceOrig;
    				} else {
    					ratePrice = rate.roomPrice.priceModule.priceNormal;
    				}

    				//console.log(rateHighlights);

    				roomHTML += '<div class="rate">' 
    							+ cancellation 
    							+ wrHTML
    							+ rateHighlights
    							+ '<div class="price">' + ratePrice + '</div>'
    							+ '<div class="book" style="text-align:right; margin:8px 0; border-top:dotted 1px #ccc; padding-top:8px;"><div style="font-size:12px; color:#999; padding-bottom:8px;">Price for 1 night including all taxes and fees</div><button style="background-color:#2989d7; color:#fff; border-radius:4px; border:0; font-size:14px; padding:4px 16px;">Book now</button>' + pay_at_hotel + '</div>'
    							+ '</div>'
        			
    			});

    			$("#rooms-wrapper").append(
    				'<div class="room">' 
    				+ '<div class="room-detail">'
    					+ newIMGURLHTML
    					+ '<div style="padding:4px 16px 16px;">' 
    						+ '<div style="font-size:16px; font-weight:bold;">' + obj[0].roomRateName + '</div>'
    						+ '<div style="margin:8px  0 0; font-size:12px">' 
    							+ '<div style="display:inline-block; vertical-align:top; margin-right:16px;"><img src="i/room_size.png" /></div>'
    							+ '<div style="display:inline-block; vertical-align:top; padding-top:6px">' + occupancyHTML + '</div>'
    						+ roomHighlights
    						+ '<div style="font-size:13px; padding:8px 0;">' + obj[0].bedTypes[0] + '</div>'
    						
    						+ '<div><a href="#" class="showmore" style="font-size:13px">Room information</a>'
    						+ roomDescription

    					+ '</div>'

    				+ '</div>' 
    				
    				//+ '<div class="rates">' + roomHTML + '</div>'
    				+ '</div>'
    				+ '<div id="rooms-rates">'
    				+ roomHTML
    				+ '</div>'
    				+ showRoomRatesHTML
    				
    			);
			});


		}

			// run things on page load
			$(function(){

				var hotelId = getParameterByName("hotelId") //"215012"
				fetchHotelDetails(hotelId, displayDetails);

				$("#rooms-wrapper").on("click", ".showmore", function(e){
					e.preventDefault();
					$(this).siblings(".room-description").show();
				}); 
				$("#rooms-wrapper").on("click", "#show-room-rates", function(e){
					e.preventDefault();
					$(this).siblings("#rooms-rates").toggle();
					//alert("clicked")
				});


				//$("#header-wrapper").load("components/header.html");
			});

		</script>

	</head>

	<body>

	<style type="text/css">
		#pricing, , #hotel-description, #map, #guest-reviews, #rewards {padding:8px; border-bottom:dotted 1px #ddd;}
		#hotel-details  {padding:8px;}
		#hotel-details h1 {font-size:18px; font-weight:bold; margin-bottom:8px;}

		#hotel-details #address {font-size:12px;}
		#hotel-details #phonenumber {color:blue; font-size:12px; margin-top:4px}

		#photos {overflow:hidden;}
		#photos img {width: 100%}
		#map {overflow:hidden; height:150px;}
		#map img {}
		
	</style>

		<div id="page-wrapper" style="width:320px; margin:0px auto; padding:0 16px;">
			<div id="header-wrapper" style="background-color:#d41200; height:30px"></div>
			<div id="hotel-details">
				<h1></h1>
				<div id="address"></div>
				<div id="phonenumber">0203 564 4408‎</divn>
			</div>
			
			<div id="price"></div>
			<div id="priceInfo"></div>
			<div id="priceSummary"></div>

			<div style="overflow:hidden; margin:16px 0;">
				<div style="width:50%; float:left;">Best price guarantee</div>
				<div style="float:right; text-align:right;"><button>Book now</button></div>
			</div>
			
			<div id="photos">
				
			</div>
			<div id="hotel-description">
				description
			</div>
			<div id="map">
				
			</div>
			<div id="guest-reviews">
				
			</div>
			<div id="rewards">
				HCOM rewards
			</div>
			

			<div id="rooms-wrapper" >
			</div>

		</div>

		

		
	</body>
</html>