<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Meta tags -->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="mobile-web-app-capable" content="yes">

		<!-- style sheets -->
		<link rel="stylesheet" type="text/css" href="../common.css">

		<style type="text/css">
		body {font-size: 14px}
		ul {margin:0; padding:0;}
		a {color:#026dc5;}
		#wrapper-query {background-color:#eae8e0;}
		#query {max-width:1160px; margin:0 auto; padding: 16px; box-sizing:border-box;}
		#wrapper-results {max-width:1160px; margin:0 auto; padding:0 16px 0; box-sizing:border-box;}
		#wrapper-results #filters {width:225px; float:left; background-color:#f5f4f0;}
		#wrapper-results #list {width:calc(100% - 245px); float:right;  height:400px;}
		#wrapper-results #sort {padding:16px 0; border-bottom:solid 1px #ccc;}
		#wrapper-results #list #hotels .hotel-card {margin-top:16px; border:solid 1px #eee; padding:8px; border-radius:4px; position:relative}
		#wrapper-results #list #hotels .hotel-card .details {display: inline-block; vertical-align: top; margin-left:8px;}
		#wrapper-results #list #hotels .hotel-card .address {font-size:12px; display: block; margin-top:4px;}
		#wrapper-results #list #hotels .hotel-card .neighbourhood {font-size:12px; display: block; margin-top:4px;}
		#wrapper-results #list #hotels .hotel-card .thumbnail {height:80px; width:120px; overflow:hidden; display:inline-block; vertical-align: top; position:relative;}
		
		#wrapper-results #list #hotels .hotel-card .thumbnail img {width:100%; position:absolute; bottom:0;}
		#wrapper-results #list #hotels .hotel-card .price {position:absolute; right:16px; top:0; text-align: right;}

		#location-list {position:absolute; top:0; bottom:0px; left:0px; right:0px; width:200px;  background-color:#fff; border-right:8px #fff solid; overflow-y: scroll; box-sizing: border-box; padding:8px; background-color:#eee;}

		
    	.container {margin-bottom:16px; padding:0 8px;}
    	#price {background-color:  #eae8e0; padding:8px 24px 16px ;}
    	.container h3 {font-size:14px; margin:8px 0;}
    	.container ul.tags {margin:0; padding:0;}
    	.container ul.tags li {list-style-type: none; display:inline-block; margin:0; padding:4px 8px; background-color:#eee; border-radius:4px; font-size:12px; text-transform: uppercase;}
    	h1 {margin:0; padding:0; font-size: 20px}



		

	#overlay:hover {cursor:pointer;}
		</style>


	</head>

	<body>

	<!-- common elements -->
		<div id="header"></div>
		<div id="nav"></div>
		
		<div id="wrapper-query">
			<div id="query">
				
				<img src="http://www.hotels.com/da/assets/s/41.0/images/themes/red/pages/sha/map.png" style="display:inline-block; border:3px solid #fff; vertical-align:top;"/>
				<div style="display:inline-block; margin-left:20px; vertical-align:top;">
					<h1 id="destination"></h1>
					<div style="padding:4px 0 0 0; font-size:16px">Wed 22 - Thu 23 June 2016, 1 night, 1 room, 2 adults</div>
						
				</div>

			</div>
		</div>


		<div id="wrapper-results">
			<div id="filters">
				<div>
					<h2>Narrow results:</h2>
					<div id="total-hotels"></div>
				</div>
				<div id="f-name-contains" class="filter">
					<h3>Name contains</h3>
					<input type="text" />
				</div>
				<div id="f-price" class="filter">
					<h3>Price</h3>
					<div style="text-align:center; font-weight:bold; margin-bottom:4px">£0 - £500+</div>
					<input type="range" name="" />
				</div>
				<div id="f-star-rating" class="filter">
					<h3>Star rating</h3>
					<ul>
						<li>
 							<input type="checkbox">
 							<label>&#9733;&#9733;&#9733;&#9733;&#9733;</label>
 						</li>
 						<li>
 							<input type="checkbox">
 							<label>&#9733;&#9733;&#9733;&#9733;</label>
 						</li>
 						<li>
 							<input type="checkbox">
 							<label>&#9733;&#9733;&#9733;</label>
 						</li>
 						<li>
 							<input type="checkbox">
 							<label>&#9733;&#9733;</label>
 						</li>
 						<li>
 							<input type="checkbox">
 							<label>&#9733;</label>
 						</li>
					</ul>
				</div>
				<div id="f-guest-rating" class="filter">
					<h3>Guest rating</h3>
					<div style="text-align:center; font-weight:bold; margin-bottom:4px">0 - 5</div>
					<input type="range" name="" />
				</div>
				<div id="f-neighbourhoods" class="filter"></div>
				<div id="f-landmarks" class="filter"></div>
			</div>

			<script id="some-template" type="text/x-handlebars-template">
 				{{#each hotels}}
 					<div class="hotel-card">
 						<div class="thumbnail">
 							<img src="{{imageUrl}}" />
 						</div>
 						<div class="details">
       	 					<a class="name" href="#">{{hotelName}}</a>
       	 					<span class="address">{{address1}}, {{address2}}, {{locality}}, {{region}}</span>
       	 					<span class="neighbourhood">{{location}}</span>
       	 				</div>
       	 				<div class="price" style="">
       	 					{{#if promoPriceDetails}}

       	 				{{#if promoPriceDescription.length}}
       	 					<div class="specialDeal">
       	 						<span class="description">{{promoPriceDescription}}</span>
       	 						<span class="strikethrough">{{avgPrice}}</span> 
       	 						<span class="total">{{promoPriceDetails.prefix}}{{promoPriceDetails.formattedValue}}</span>
       	 					</div>
       	 				{{else}}
       	 					<div class="standard">{{promoPriceDetails.prefix}}{{promoPriceDetails.formattedValue}}</div>
       	 				{{/if}}
       	 				
       	 			{{else}}
       	 				<div class="standard">{{avgPrice}}</div>
       	 			{{/if}}
       	 				</div>
       	 			</div>
		      	{{/each}}
    		</script>


			<div id="list-1"></div>
			
			<div id="list">
				<div id="sort">Sort by</div>

				<div id="guide" style="padding:8px; background-color:#026dc5; margin-top:8px; color:#fff;">Not sure which part of <span class="dest"></span> is right for you? <a href="#" style="color:#fff; font-weight:bold">Explore our guide to <span class="dest"></span> neighbourhoods</a></div>


				<div id="hotels">
					
				<div id="loading-hotels" style="font-size:20px; margin-top:40px; text-align:center; display:none;">fetching hotels...</div>

				</div>	
			</div>
		</div>
		
<div id="overlay" style="position:fixed; top:0; left:0; right:0; bottom:0; background-color:#000; opacity:0.7; display:none;"></div>

<div id="guides" style="position:fixed; top:0px; width:636px; bottom:0; right:0px; background-color:#fff; display:none;">
	<h2 style="position:absolute; top:0;margin:0; padding:0; left:0; right:0; color:#fff; background-color:#d41200; padding:28px 16px 8px">Popular neighbourhoods</h2>
	
	<div style="position:absolute; top:70px; left:16px; bottom:0; right:0; padding-right:16px;">

		<div id="neighbourhoods" style="position:absolute; top:0px; bottom:0; left:0; right:0;">
			
		</div>

	</div>

</div>

<style type="text/css">
	#neighbourhoods {overflow-y: scroll;}
	.neighbourhood-card h2 {margin:0; padding:8px; background-color:#000; color:#fff; font-size:14px;}
	.neighbourhood-card h3 {margin:0; padding:4px 0; color:#000;  font-size:14px;}
	.neighbourhood-card {margin-bottom:8px; padding:8px 0; border-bottom:solid 1px #eee;}

			.neighbourhood-card .image {position:relative; display:inline-block; vertical-align:top;}
			.neighbourhood-card .image img.thumb {}
			.neighbourhood-card .image img.map {display:inline-block; vertical-align: top}
			.neighbourhood-card .name {color:#000; font-weight: bold; font-size:18px; position:absolute; top:12px; left:0px; padding:8px;  max-width:200px;}
			.neighbourhood-card .content {box-sizing: border-box; padding-left:8px;}
			.tags {margin:0; padding:0;}
			.tags li {list-style-type: none; display:inline-block; padding:0; margin:0; background-color:#eee; padding:4px 8px; margin-right:4px; border-radius:4px; font-size:12px; font-weight:bold; margin-bottom:4px;}
	.neighbourhood-card p.description {line-height: 20px; padding-right:16px;}
			.landmarks li {list-style-type: none; margin-bottom:4px;}
			.prices li {list-style-type: none; margin-bottom:4px;}

	.neighbourhood-card button {background-color:#026dc5; color:#fff; font-size:16px; padding:8px 16px; border-radius: 4px; border:0; margin-bottom:8px;}

	#filters > div {box-sizing: border-box; padding:8px; }
	#filters ul {list-style-type: none;}
	#filters .filter {border-top:solid 1px #ddd;}
	#filters  h2 {font-size:16px; font-weight:bold; margin:0 0 12px 0; padding:0;}
	#filters .filter h3 {font-size:14px; font-weight:bold; margin:0 0 12px 0; padding:0;}
	#filters .filter ul li {overflow:hidden; margin-bottom:4px;}
	#filters .filter ul li input[type="checkbox"] {float:left; width:16px; padding:0;}
	#filters .filter ul li label {float:left; width:calc(100% - 30px); padding:2px 0 0 0; font-size: 12px}

</style>

<script id="filters-neighborhoods" type="text/x-handlebars-template">
 	<h3>Neighbourhoods</h3>
 	<ul>
 		{{#each this}}
 		<li>
 			<input type="checkbox">
 			<label>{{title}}</label>
 		</li>
 		{{/each}}
 	</ul>			
</script>

<script id="filters-landmarks" type="text/x-handlebars-template">
 	<h3>Landmarks</h3>
 	<ul>
 		{{#each this}}
 		<li>
 			<input type="checkbox">
 			<label>{{title}}</label>
 		</li>
 		{{/each}}
 	</ul>			
</script>


<script id="neighbourhood-card" type="text/x-handlebars-template">
 			{{#each this}}
 				<div class="neighbourhood-card {{hideNeighbourhood hasContent}}" rel="{{addCount}}">
 					
 					<div class="image">
 						
 						<div style="overflow:hidden; width:300px; display:inline-block;"><img style="height:220px; text-align:center" class="thumb" src="{{image}}" /></div>
 						<img class="map" src="{{staticMapLink staticMapUrl}}" />
 						<div class="name"><span style="display: inline;
  background: #fff;
  box-shadow: 10px 0 0 #fff, -10px 0 0 #fff; padding:8px 0; line-height:30px">{{name}}</span></div>
 					</div>

 					<div class="content">
 					
 					<div style="overflow:hidden; margin-top:12px;">
 						<div style="float:left; width:33%">
 							<h3>Average prices</h3>
 							<ul class="prices">
 								<li>3 Star from £123</li>	
 								<li>4 Star from £123</li>	
 								<li>5 Star from £123</li>	
 							</ul>
 						</div>

 						<div style="float:left; width:33%; box-sizing:border-box; padding-right:12px">
 							<h3>Great for</h3>
 							<ul class="tags">
 								{{displayTags tags}}
 							</ul>

 						</div>
 						<div style="float:left; width:33%">
 						<h3>Landmarks</h3>
 						<ul class="landmarks">
 							{{displayTags landmarks}}	
 						</ul>

 					</div>
 						
 					</div>
 					<p class="description">{{description}}</p>

 					<button>Search for hotels in {{name}}</button>
 					
 					
 					
 					</div>

 					
 				</div>
		    {{/each}}
    	</script>



		<!-- Scripts -->

      	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="../hcom-services.js"></script>
		<script src="../handlebars.js"></script>
		<script src="content.js"></script>
		<script src="methods.js"></script>

		<!-- JQuery Google CDN -->
		
		<script type="text/javascript">
			var count = 0;
			// run things on page load
			$(function(){

				if (getParameterByName("localhost")) {
					$.getJSON( "../ny-json.js", function( data ) {
  					displayHotels(data);
  					displayFilters(data)
				});
				} else {
					if (getParameterByName("destination")) {
						//fetch hotels from mobile API
						fetchHotelList(getParameterByName("destination"), displayContent);
						//fetchHotelList(getParameterByName("destination"), displayFilters);
						$("#loading-hotels").show();
						fetchContent();

						var d = getParameterByName("destination"); 
						var dd = d.split(",")
						$("span.dest").append(dd[0]);
						$("#destination").text(d);
					
					} else {

					}
				}

      			
				

				// neighbourhood guides

				$("#guide a").on("click", function(e){
					$("#overlay").show();
					$("#guides").show();
				});

				$("#overlay").on("click", function(e){
					$("#overlay").hide();
					$("#guides").hide();
				});

				


			});

			var displayContent = function(data){
				displayHotels(data);
				displayFiltersNeighbourhoods(data.result.neighborhoods);
				displayFiltersLandmarks(data.result.landmarks);
				$("#total-hotels").text(data.result.matchingHotels + " hotels")
			}

			var displayFiltersNeighbourhoods = function (data){
				var source   = $("#filters-neighborhoods").html();
  				var template = Handlebars.compile(source);
  				$("#f-neighbourhoods").html(template(data));
			}

			var displayFiltersLandmarks = function (data){
				var source   = $("#filters-landmarks").html();
  				var template = Handlebars.compile(source);
  				$("#f-landmarks").html(template(data));
			}

			

			var displayHotels = function (data) {

				$("#loading-hotels").hide();
				
				// get hotel data
				var hotels = data.result;
				console.log(hotels);
				
				// attach to handle bar template
        		var source   = $("#some-template").html();
  				var template = Handlebars.compile(source);
  				$("#hotels").html(template(hotels));
			}; 

			var displayNeighbourhoods = function(data){
				console.log("nhoods")
				// hide loading message
				//$("#loading-hotels").hide();
			
				var neighbourhood = data;
				console.log(neighbourhood);
				
				// attach to handle bar template
        		var source   = $("#neighbourhood-card").html();
  				var template = Handlebars.compile(source);
  				$("#neighbourhoods").html(template(neighbourhood));
			}

			Handlebars.registerHelper("addCount", function(){
				count++
				return count;
			});

			Handlebars.registerHelper("hideNeighbourhood", function(hasContent){
				if (hasContent == false){
					return "hide";
				} else {
					return "";
				}
				
			});

			Handlebars.registerHelper("displayTags", function(tags){
				var tStr = tags.split(", ");
				var tagsStr = ""

				$.each(tStr, function(i, tag) {
					tagsStr += "<li>" + tag + "</li>"
				});

				return new Handlebars.SafeString(tagsStr);
			});

			Handlebars.registerHelper("staticMapLink", function(staticMapUrl){
				var smURL = "http://maps.googleapis.com/maps/api/staticmap?";
				smURL += "&center=" + destinationObj[0].map;
				smURL += "&zoom=" + destinationObj[0].staticMapZoom;
				smURL += "&size=300x220"
				smURL += "&sensor=false"
				smURL += "&path=color:red|weight:1|fillcolor:red|" + staticMapUrl

				console.log(smURL);

				//http://maps.googleapis.com/maps/api/staticmap?
				//center=35.6712935174737,139.764315704409
				//&zoom=11
				//&size=250x125
				//&sensor=false
				//&path=color:red|weight:1|fillcolor:red|35.666941,139.722226|35.668363,139.730487|35.669198,139.73818|35.670999,139.742897|35.689,139.752|35.689,139.722|35.666941,139.722226



				return smURL;
			})

			

		</script>
	</body>
</html>