<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Meta tags -->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="mobile-web-app-capable" content="yes">

		<!-- style sheets -->
		<link rel="stylesheet" type="text/css" href="css/reset.css">
		<link rel="stylesheet" type="text/css" href="css/mt-base.css">

		<!-- Roboto font -->
		<link href='http://fonts.googleapis.com/css?family=Roboto:400,400italic,700,700italic' rel='stylesheet' type='text/css'>

		<!-- Scripts -->
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>

		<script type="text/javascript">

			$(function(){

				$( "#itinerary-elements ul" ).sortable({
  					placeholder: "empty"
				});
    			$( "#itinerary-elements ul" ).disableSelection();

				$.ajax({
        			crossDomain: true,
        			//url: "https://api.eancdn.com/ean-services/rs/hotel/v3/list",
        			url: "http://api.tripadvisor.com/api/partner/2.0/location/190454/attractions?subcategory=other&key=ebf73cf58f37431baa30d8cf98bd0884",
			        type: "GET",
			        dataType : "json",
					timeout:3000,
 
        			success: function( json ) {
        				
        				var list = json.data
        				console.log(list);

        				$.each(list, function(i, poi) {
        					console.log(poi.name);
        					$("#list").append(
        						"<div class='item' id='" + poi.location_id + "'><div>" 
        						+ "<div class='name' style='margin-bottom:6px;'>" + poi.name + "</div>"
        						+ "<div class='snippet'></div>"
        						+ "<div style='position:absolute; bottom:8px; left:8px;'>"
        						+ "<div style='font-size:12px'><img src='" + poi.rating_image_url + "' style='height:14px'/> (" + poi.num_reviews + ") reviews</div>"
        						+ "<div style='font-size:12px'>" + poi.percent_recommended + "% recommended</div>"
        						+ "</div>"
        						+ "</div></div>"

        					)
        					fetchLocationDetails(poi.location_id);

        					if (poi.wikipedia_info != null) {
        						console.log("not null");
        					}
        					//fetchThumbnail(poi.location_id, poi.)
        				});
        			}
        			
        		});

				$("#list").on("click", "div.item", function(){
					console.log($(this).attr("id"));
					$(this).addClass("item-selected");
					var name = $(this).find(".name").text(); 
					var id = $(this).attr("id");
					$("#itinerary-elements ul").append(
						"<li>" + name
						+ "<div class='delete' rel=" + id + " > X </div>"
						+ "</li>"
					);
				});

				$("#itinerary-elements ul").on("click", ("li div.delete"), function(){
					console.log($(this).attr("rel"));
					$("#list").find("div#" + $(this).attr("rel")).removeClass("item-selected");
					$(this).closest("li").remove();
				})

			});

			function fetchLocationDetails(id){
				var apiLink = "http://api.tripadvisor.com/api/partner/2.0/location/"+id+"?key=ebf73cf58f37431baa30d8cf98bd0884"

				$.ajax({
        			crossDomain: true,
        			//url: "https://api.eancdn.com/ean-services/rs/hotel/v3/list",
        			url: apiLink,
			        type: "GET",
			        dataType : "json",
					timeout:3000,
 
        			success: function( json ) {
        				console.log(json.reviews[0].text)
        				$("#list").find("div#" + id + " div.snippet").text('"' + json.reviews[0].text + '"')
        			
        			}
        			
        		});

				
			}

			function fetchThumbnail(id, wikiid){

				var wikilink = "https://en.wikipedia.org/w/api.php?action=query&prop=pageimages&format=json&piprop=thumbnail&pithumbsize=200&rawcontinue=&pageids="+wikiid+"&redirects="

				$.ajax({
        			//crossDomain: true,
        			//url: "https://api.eancdn.com/ean-services/rs/hotel/v3/list",
        			url: wikilink,
			        type: "GET",
			        contentType: "application/json; charset=utf-8",
			        async: false,
			        dataType : "jsonp",
					timeout:3000,
 
        			success: function( json ) {
        				console.log(json.query.pages)
        				//$("#list").find("div#" + id + " div.snippet").text('"' + json.reviews[0].text + '"')
        			
        			}
        			
        		});

			}

		</script>

	</head>

	<body id="details">
		<div id="header">
			<div id="logo">My Trips</div>
			<div id="tools">Sign in | Sign up</div>
		</div>

		<div id="itinerary" class="panel">
			
			<div style="border-bottom:solid 1px #D6D3C0">
				<ul id="dates">
					<li class="selected">Day 1</li>
					<li>Day 2</li>
					<li>Day 3</li>
				</ul>
			</div>
			<div id="itinerary-elements">
				<ul>
				</ul>
				<div class="empty">Add things to your itinerary</div>
			</div>
			
		</div>

		<div id="content" class="panel">
				
				<div style="height:100px; padding:18px">
					<h1 style="font-size:24px;">Airport first?</h1>
				</div>

				<div style="margin-left:18px;" id="list">
					<img src="i/details_trip.png" />
					<h3 style="margin:0 0 18px 0;">
						Top 10 attractions in Vienna
					</h3>
					
					
				</div>

		</div>

		

		
	</body>
</html>