<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Meta tags -->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="mobile-web-app-capable" content="yes">

		<!-- style sheets -->
		<link rel="stylesheet" type="text/css" href="css/reset.css">
		<link rel="stylesheet" type="text/css" href="css/mt-base.css">

		<!-- Roboto font -->
		<link href='http://fonts.googleapis.com/css?family=Roboto:400,400italic,700,700italic' rel='stylesheet' type='text/css'>

		<!-- Scripts -->
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.3/jquery-ui.min.js"></script>
		<script src="tabletop.js"></script>

		<script type="text/javascript">

			

			$(function(){

				Tabletop.init( { key: '1OyBSRHM5jfeHGqiFSdAHikPP0MBBNfw1k4epiF7Nib0',
                   callback: function(data, tabletop) {displayList (data) },
                   simpleSheet: false } );

				$( "#itinerary-elements ul" ).sortable({
  					placeholder: "empty"
				});
    			$( "#itinerary-elements ul" ).disableSelection();

				var displayList = function(data){
					console.log(data);
					console.log(data.Attractions.elements)

					$.each(data.Attractions.elements, function(i, poi) {
						console.log(poi.Title)
					});

					$.each(data.Attractions.elements, function(i, poi) {
        					console.log(poi.Title);
        					$("#list").append(
        						"<div class='item' id='" + poi.ID + "'><div>" 
        						+ "<div class='image'></div>"
        						+ "<div class='name' style='margin-bottom:6px;'>" + poi.Title + "</div>"
        						+ "<div class='snippet'>" + poi.Description + "</div>"
        						+ "<div style='overflow:hidden; margin-top:8px'>"
        						+ "<div style='font-size:12px; float:left;'>" + poi.Rating + " (" + poi.Reviewers + ") reviews</div>"
        						+ "<div style='font-size:12px; float:right;'>" + poi.Percent_Rec + "% recommended</div>"
        						+ "</div>"
        						+ "</div></div>"

        					)
        					//fetchLocationDetails(poi.location_id);
        				});
				}




				$("#list").on("click", "div.item", function(){
					console.log($(this).attr("id"));
					$(this).addClass("item-selected");
					var name = $(this).find(".name").text(); 
					var id = $(this).attr("id");
					var index = $("#itinerary-elements ul li").length
					console.log(index);
					$("#itinerary-elements ul").append(
						"<li rel='" + name + "'>" 
						+ "<div class='name'>" + name + "</div>"
						+ "<a class='time' rel='" + index + "'></a>"
						+ "<div class='delete' rel=" + id + " > X </div>"
						+ "</li>"
					);
					//console.log(name)
					if ($("#itinerary-elements ul li").length >= 2){
						calcRoute($("#itinerary-elements ul li").length-2, $("#itinerary-elements ul li").length-1);
					}
					
				});

				$("#itinerary-elements ul").on("click", ("li div.delete"), function(){
					//console.log($(this).attr("rel"));
					$("#list").find("div#" + $(this).attr("rel")).removeClass("item-selected");
					$(this).closest("li").remove();
				})

				$("#itinerary-elements ul").on("click", ("li a.time"), function(){
					$("#directions-window").show();
					console.log($(this).attr("rel"))
					initialize($(this).attr("rel"));
					//var index = $(this).parent().children().index(this);
					//console.log($(this).attr("rel"));
				});

				$("#close-map").on("click", function(e){
					e.preventDefault();
					$("#directions-window").hide();
					$("#directions-panel").empty();
				})

			});

			

			
			
            

		</script>

	</head>

	<body id="details">
		<div id="header">
			<div id="logo">My Trips</div>
			<div id="tools">Sign in | Sign up</div>
		</div>

		<div id="itinerary" class="panel">
			
			<div style="border-bottom:solid 1px #D6D3C0">
				<ul id="dates">
					<li class="selected">Day 1</li>
					<li>Day 2</li>
					<li>Day 3</li>
				</ul>
			</div>
			<div id="itinerary-elements">
				<ul>
				</ul>
				<div class="empty">Add things to your itinerary</div>
			</div>
			
		</div>

		<div id="content" class="panel">
				
				<div style="height:100px; padding:18px">
					<h1 style="font-size:24px;">Airport first?</h1>
				</div>

				<div style="margin-left:18px;" id="list">
					
					
					
				</div>

		</div>

		<style type="text/css">
			#map-canvas {height:100%;}
			#results {
        font-family: Arial, Helvetica, sans-serif;
        position: absolute;
        left: 0px;
        top: 0;
        bottom:0;
        width: 350px;
        padding: 12px;
        z-index: 5;
        background: #fff;
          overflow-y: scroll;
      }

      	.adp-directions {width:100%;}
      .adp-directions td {padding:8px 0;}
		</style>
		<div id="directions-window" style="display:none; position:absolute; top:30px; left:0; right:0; bottom:0; background-color:#fff;">
			
			<div id="results">
				<a href="details.html" id="close-map" style="font-size:12px; display:block; margin-bottom:12px;">< Daily planner</a>
				<div id="directions-panel" style="margin-top:12px; overflow-y:scroll; position:absolute; top:30px; bottom:0; left:12px; right:12px; font-size:14px;"></div>
			</div>

			<div id="map-wrapper" style="position:absolute; top:0px; left:360px; right:0; bottom:0;">
      			<div id="map-canvas"></div>
    		</div>
		</div>
		

		
	</body>
</html>